<template>
  <div>
    <main>
      <div class="offer pb-[64px] md:pb-[120px] relative w-full min-h-screen overflow-hidden offer_bgLinear__vFptl">
        <div class="css-1km3mtt ant-app">
          <div class="relative z-20 h-[187px] md:h-[309px] lg:h-[285px] bg-no-repeat">
            <picture>
              <source srcset="/images/bitget/banner-bg.3eef0521.svg" media="(min-width: 1px) and (max-width: 640px)">
              <source srcset="/images/bitget/banner-bg-md.5e0624e6.svg"
                      media="(min-width: 641px) and (max-width: 768px)">
              <source srcset="/images/bitget/banner-bg-lg.4bf2e9d5.svg"
                      media="(min-width: 769px) and (max-width: 1024px)">
              <source srcset="/images/bitget/banner-bg-2xl.8d79a9b3.svg"
                      media="(min-width: 1025px) and (max-width: 9999px)">
              <img src="/images/bitget/banner-bg-2xl.8d79a9b3.svg" alt="banner-bg-2xl" loading="eager" decoding="async"
                   class="absolute z-0 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
            </picture>
            <div class="absolute z-20 top-1/2 left-1/2 w-full max-w-[1200px] h-full -translate-x-1/2 -translate-y-1/2">
              <img src="/images/bitget/banner-dollar.e03ebc10.svg" alt="banner-dollar" loading="lazy" decoding="async"
                   class="absolute -bottom-4 md:-bottom-8 2xl:-bottom-12 end-4 lg:end-[120px] w-[84px] md:w-[120px] 2xl:w-[150px]"><img
                src="/images/bitget/banner-point.a8a00057.svg" alt="banner-point" loading="lazy" decoding="async"
                class="absolute top-0 md:top-6 lg:top-5 end-12 md:end-[120px] lg:end-[140px] w-[60px] md:w-[80px] 2xl:w-[110px] offer_routeY180__z_GFt"><img
                src="/images/bitget/banner-point.a8a00057.svg" alt="banner-point" loading="lazy" decoding="async"
                class="absolute bottom-[57px] md:bottom-8 start-0 md:start-[70px] w-[40px] md:w-[80px] 2xl:w-[110px] offer_bannerSmallPointRotate__p6KlV">
            </div>
            <img src="/images/bitget/banner-left-arrow.49f066c3.svg" alt="banner-left-arrow" loading="lazy"
                 decoding="async"
                 class="absolute z-10 -bottom-8 md:-bottom-10 2xl:-bottom-[200px] -start-4 md:-start-[80px] 2xl:-start-[90px] w-[123px] h-[141px] md:w-[216px] md:h-[247px] offer_routeY180__z_GFt"><img
              src="/images/bitget/banner-right-arrow.13121691.svg" alt="banner-right-arrow" loading="lazy"
              decoding="async"
              class="absolute z-10 top-[-45px] md:top-[-35px] 2xl:top-0 -end-[70px] md:-end-[80px] w-[163px] h-[99px] md:w-[286px] md:h-[175px] offer_routeY180__z_GFt">
            <div
                class="relative z-30 flex flex-col justify-center h-full mx-auto max-w-[343px] md:max-w-[600px] lg:max-w-full overflow-hidden">
              <h1
                  class="my-0 mx-auto font-bold text-primaryText text-2xl md:text-[2.5rem] lg:text-5xl leading-8 md:leading-[48px] lg:leading-[57px] text-center">
                邀請 10 位好友助力，即可領取 <span class="text-[#FCE917]">20 USDT</span></h1>
              <p
                  class="mt-2 mb-0 mx-auto font-medium md:font-base text-primaryText text-sm md:text-xl leading-6 md:leading-7 text-center">
                本輪助力完成後，每位好友也可領 <span class="text-[#FCE917]">5 USDT</span></p>
            </div>
            <div class="md:hidden absolute z-40 top-3 -end-[6px] block lg:hidden">
              <div>
                <div
                    class="cursor-pointer h-[24px] bg-[#FFFFFF] rounded-s-[12px] px-[17px] font-[500] text-center text-[12px] leading-[24px] text-gray-800">
                  規則
                </div>
              </div>
              <div></div>
            </div>
          </div>
          <div class="mx-[16px] md:mx-[24px] lg:mx-[40px] xl:mx-auto max-w-[1200px]">
            <div class="offer_currentActivityBorderLinear__DmVOy relative rounded-[16px]">
              <div class="bg-bg rounded-[16px]">
                <div class="offer_currentActivityBgLinear__ACxZX rounded-[16px] pb-[32px] md:pb-[48px]">
                  <div
                      class="offer_statusHighLightLinear__deoJD relative top-[-1px] start-[-1px] inline-block  ltr:rounded-tl-[16px] rtl:rounded-tr-[16px] ltr:rounded-br-[16px] rtl:rounded-bl-[16px] py-[5px] md:py-[14px] px-[16px] md:ps-[24px] md:pe-[41px] max-w-[245px] md:max-w-none leading-[20px] text-xs md:text-base text-blackText">
                    邀請 <strong class="px-[2px] font-bold">10 人</strong> 以獲得獎勵
                  </div>
                  <div class="px-[16px] md:px-[24px]">
                    <div class="mt-[24px] md:mt-[32px] text-start">
                      <h3 class="flex my-0">
                        <div class="my-[6px] md:my-[2px] w-[3px] bg-[#00FFF1] me-[8px]"></div>
                        <span class="me-1 text-primaryText text-xl md:text-[1.75rem] leading-[28px] font-medium">好友助力你領取
                          <span class="border-dashed border-0 border-b-[1px] text-[#FCE917] cursor-pointer">20
                            USDT</span></span>
                        <div class="flex items-center cursor-pointer"></div>
                      </h3>
                      <p
                          class="mt-[4px] md:mt-[12px] ms-[11px] text-xs md:text-sm md:font-medium text-[#559EA6] leading-[18px] md:leading-[22px]">
                        每邀請 1 位好友在 Bitget 註冊並累計交易滿 50 USDT，即視為助力成功 1 次。</p>
                    </div>
                    <div class="flex justify-center mt-2 gap-2 items-center" v-if="store.state.userInfo?.code">
                      <div class="demo-progress">
                        <el-progress :text-inside="true" :stroke-width="28" :percentage="state.percentageProcess"
                                     status="success"/>
                      </div>
                    </div>
                    <div
                        class="md:relative flex items-center mt-6 md:mt-6 gap-x-[10px] md:gap-x-0 mx-auto max-w-[311px]">
                      <div @click="onPopup"
                           class="relative w-full bg-[#00FFF1] rounded-[99px] py-[10px] text-center font-[600] cursor-pointer text-[14px] leading-[19px]  shadow-[0_6px] shadow-[#007A74]">
                        <img src="/images/bitget/btn-pointer.561cae66.png" alt="btn-pointer" loading="lazy"
                             decoding="async" class="absolute top-4 right-12 w-12 offer_btnPointer__89czm">
                        <span class="text-gray-800">登入並開始邀請</span>
                      </div>
                    </div>
                    <div
                        class="md:relative flex justify-end mt-10 md:mt-10 gap-x-[10px] md:gap-x-0 mx-auto max-w-[311px] cursor-pointer"
                        @click="openWhatsApp(0)">
                      <span class="text-black rounded-[99px] py-1 px-3 bg-[#FCE917] shadow-[0_4px] shadow-[#007A74]">下载
                        whatsApp</span>

                    </div>
                    <div class="mt-[32px] md:mt-[56px]">
                      <h3 class="flex my-0">
                        <div class="my-[6px] md:my-[2px] w-[3px] bg-[#00FFF1] me-[8px]"></div>
                        <span
                            class="text-primaryText text-xl md:text-[1.75rem] leading-[28px] font-medium">如何獲得獎勵</span>
                      </h3>
                      <div
                          class="flex flex-col md:flex-row justify-between items-start mt-[24px] md:mt-[42px] mx-[2px] md:mx-[24px] lg:mx-auto max-w-[1024px] text-start md:ltr:text-center md:rtl:text-center">
                        <div class="flex gap-x-4 md:gap-x-0 md:flex-col items-center"><img
                            src="/images/bitget/register.46f6bcda.svg" alt="register" loading="lazy" decoding="async"
                            class="w-[32px] md:w-[64px] h-[38px] md:h-[76px]"><label
                            class="md:mt-[6px] md:w-[180px] lg:w-[240px] text-primaryText text-sm md:text-base leading-5 md:leading-[22px]">‌邀請好友</label>
                        </div>
                        <div
                            class="md:flex-1 md:self-center ms-4 md:ms-0 my-1 md:my-0 border-dashed border-[#169784] border border-0 border-l-[1px] md:border-l-0 md:border-t-[1px] min-h-[32px] md:min-h-0">
                        </div>
                        <div class="flex gap-x-4 md:gap-x-0 md:flex-col items-center"><img
                            src="/images/bitget/success.2df18327.svg" alt="success" loading="lazy" decoding="async"
                            class="w-[32px] md:w-[64px] h-[38px] md:h-[76px]"><label
                            class="md:mt-[6px] md:w-[180px] lg:w-[240px] text-primaryText text-sm md:text-base leading-5 md:leading-[22px]">2
                          位好友助力成功。</label></div>
                        <div
                            class="md:flex-1 md:self-center ms-4 md:ms-0 my-1 md:my-0 border-dashed border-[#169784] border border-0 border-l-[1px] md:border-l-0 md:border-t-[1px] min-h-[32px] md:min-h-0">
                        </div>
                        <div class="flex gap-x-4 md:gap-x-0 md:flex-col items-center"><img
                            src="/images/bitget/rewards.276b009a.svg" alt="rewards" loading="lazy" decoding="async"
                            class="w-[32px] md:w-[64px] h-[38px] md:h-[76px]"><label
                            class="md:mt-[6px] md:w-[180px] lg:w-[240px] text-primaryText text-sm md:text-base leading-5 md:leading-[22px]">獎勵到帳，您領取
                          20 USDT 好友領取 5 USDT。</label></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="px-5 md:mx-[24px] lg:mx-[40px] mt-[88px] xl:mx-auto xl:max-w-[1200px]">
            <h3 class="mt-[0] font-[500] text-[40px] leading-[54px] mb-[24px] text-whiteText">條款與條件</h3>
            <div class="offer_desWrapper__xlES_">
              <div>
                <div class="font-[500] text-[16px] leading-[24px] text-whiteText my-[16px]">1. 如何參與活動？</div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">1.1 分享並邀請
                  10 名好友，每位好友均交易超過 50 USDT 即算成功助力。您可獲得20 USDT體驗金獎勵，每位好友獲得5 USDT體驗金獎勵。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">1.2
                  若本輪助力結束前，僅有 1 位好友成功助力，則本輪助力失敗，您與該好友均無法獲得獎勵。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">1.3
                  進入頁面點擊報名後，開啟活動。每次助力限制 10 天內完成，提前完成助力或者本輪未完成助力，可以發起新的一輪助力活動。
                </div>
              </div>
              <div>
                <div class="font-[500] text-[16px] leading-[24px] text-whiteText my-[16px]">2. 獎勵規則</div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">2.1
                  交易體驗金將發放至您和好友的卡券中心，卡券使用有效期為 5 天。請及時使用。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">2.2
                  任務完成後，獎勵發放需人工審核，若超過 3 個工作天仍未到帳，請聯繫客服。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">2.3
                  若用戶惡意參與本活動（包括但不限於洗錢、虛假交易、惡意套現等行為），一經發現，Bitget
                  有權對該用戶的帳戶進行異常標註，並給予相應懲罰。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">2.4 Bitget
                  將對所有用戶進行審查，對於使用任何技術手段註冊和參與（包括但不限於電子、機器人、重複、自動化等類似手段）以實現自動或重複註冊目的的用戶，其所有註冊和活動獎勵立即失效。即使該用戶並非所有註冊資訊、參與活動途徑，都採用此類惡意手段，也都判定為失效。
                </div>
              </div>
              <div>
                <div class="font-[500] text-[16px] leading-[24px] text-whiteText my-[16px]">3. 補充說明</div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">3.1
                  同一時間內，你只能選擇參與本活動或幸運大轉盤活動，不可同時參與兩個活動。若您已參與幸運大轉盤活動，在確認參與本活動時，系統將自動為您結束幸運大轉盤活動進度。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">3.2 Bitget
                  合作夥伴及專屬合夥人不適用本活動。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">3.3
                  子帳戶不能作為獨立帳戶參與該活動，且數據不併入主帳戶。
                </div>
                <div class="font-[400] text-[14px] leading-[22px] text-[#EFF1F1] mb-[8px] lg:text-[#656E6F]">3.4 以上規則自
                  2023 年 11 月 9 日 18:00（UTC+8）起生效。Bitget 保留對本活動的最終解釋權。
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <el-dialog @close="resetFields" destroy-on-close v-model="state.dialogPhoneInput"
               class="md:w-[50%] lg:w-[40%] xl:w-[30%] w-[85%] rounded-2xl" center align-center :show-close="false">
      <div class="text-lg mb-4 font-bold">
        请填入手机号码立即邀请好友
      </div>
      <el-form ref="ruleFormRef" :model="state.form" :rules="formRules">
        <el-form-item prop="phone">
          <el-input size="large" type="text" v-model="state.form.phone" placeholder="电话号码"></el-input>
        </el-form-item>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <el-button :loading="isProcessing" class="bg-gray-100 w-32 h-9 rounded-lg" @click="onSubmit(ruleFormRef)">
            <span class="text-base text-gray-800">确认</span>
          </el-button>
        </span>
      </template>
    </el-dialog>

    <!-- dialog Prompt -->
    <el-dialog destroy-on-close v-model="state.promptDialog"
               class="md:w-[50%] lg:w-[40%] xl:w-[30%] w-[85%] rounded-2xl bg-gradient-to-r from-green-200 to-green-400"
               center
               align-center :show-close="false">
      <div class="text-xl text-center font-bold">
        立即前往领取
      </div>
      <template #footer>
        <span class="dialog-footer">
          <el-button :loading="isProcessing" class="bg-[#00FFF1] w-44 h-9 rounded-2xl" @click="onConfirm">
            <span class="text-base text-gray-800">确认</span>
          </el-button>
        </span>
      </template>
    </el-dialog>
    <!-- dialog Prompt Submit first time -->
    <el-dialog destroy-on-close v-model="state.promptFirstTime"
               class="md:w-[50%] lg:w-[40%] xl:w-[30%] w-[85%] rounded-2xl" center align-center :show-close="false">
      <div class="text-xl text-center font-bold">
        如果没有安装whatsApp,请前往下载
      </div>
      <template #footer>
        <span class="dialog-footer">
          <el-button :loading="isProcessing" class="bg-[#00FFF1] w-44 h-9 rounded-2xl"
                     @click="state.promptFirstTime = !state.promptFirstTime">
            <span class="text-base text-gray-800">确认</span>
          </el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>
<script setup lang="ts">
import { reactive, watch, onMounted } from 'vue';
import formHelper, { IRule } from "../libraries/elementUiHelpers/formHelper";
import useVariable from '../composables/useVariable';
import notificationHelper from '../libraries/elementUiHelpers/notificationHelper';
import EnumMessageType from '../models/enums/enumMessageType';
import store from '../store';

const { isProcessing, ruleFormRef, api, route } = useVariable();
const state = reactive({
  form: {
    phone: null,
    url: '',
    link: '',
    click: 0,
  },
  dialogPhoneInput: false,
  promptDialog: false,
  promptFirstTime: false,
  percentageProcess: 0,
});
const resetFields = () => {
  state.form.phone = null;
  state.dialogPhoneInput = false;
};
const onPopup = () => {
  if (store.state.userInfo?.phone) {
    getIncClick();
    return window.location.href = state.form.url
  }
  state.dialogPhoneInput = true;
};
const submitProcess = async () => {
  isProcessing.value = true;
  const request = {
    phone: state.form.phone,
    code: route.query?.code,
  }
  try {
    const response = await api.savePhone(request);
    isProcessing.value = false;
    if (response.code !== 200) {
      notificationHelper.notification(response.message, EnumMessageType.Error);
    } else {
      notificationHelper.notification('成功地!', EnumMessageType.Success);
      store.commit('SET_CLICK', 1);
      openWhatsApp(1, response.data.code);
      state.promptFirstTime = true;
    }
    resetFields();
  } catch (error) {
    isProcessing.value = false;
  }
};
const getLink = async () => {
  const response = await api.getLink();
  if (response.code === 200) {
    state.form.link = response.data.link;
  }
};
const rules: Record<string, IRule> = ({
  phone: { required: true, message: '电话为必填项' },
});
const formRules = formHelper.getRules(rules);
const onSubmit = formHelper.getSubmitFunction(submitProcess);
const openWhatsApp = (type = 1, code = '') => {
  const protocol = window.location.protocol;
  const domain = window.location.hostname;
  const port = window.location.port;
  const fullDomain = protocol + '//' + domain + (port ? ':' + port : '');
  let content = "点击下面链接👇👇👇,通过参活动来赚钱吧。";
  if (type === 1) {
    content += "\n" + `${ fullDomain }?code=` + code + "\n";
    state.form.url = 'whatsapp://send/' + `?text=${ encodeURIComponent(content) }`;
    const obj = { phone: state.form.phone, code: code, url: state.form.url };
    store.commit('SET_USERINFO', obj);
    window.location.href = state.form.url;
  } else {
    content += "\n" + `${ fullDomain }/?code=${ store.state.userInfo?.code }`;
    window.location.href = 'https://api.whatsapp.com/send' + `?text=${ encodeURIComponent(content) }`;
  }
}
const getIncClick = async () => {
  const request = {
    phone: store.state.userInfo?.phone,
    code: store.state.userInfo?.code,
  }
  const response = await api.incClick(request);
  if (response.code === 200) {
    store.commit('SET_CLICK', 1);
  }
}
const setIntervalFunc = (num: number) => {
  const setInterValDialog = setInterval(() => {
    state.percentageProcess = num;
    clearInterval(setInterValDialog);
    if(state.form.click === 10) {
      state.promptDialog = true;
    }
  }, 2000);
};
watch(() => [state.form.click, store.state?.click], () => {
  if (state.form.click === 1) {
    state.percentageProcess = 0;
  } else if (state.form.click === 2) {
    setIntervalFunc(10)
  } else if (state.form.click === 3) {
    state.percentageProcess = 10
  } else if (state.form.click === 4) {
    setIntervalFunc(20)
  } else if (state.form.click === 5) {
    state.percentageProcess = 20;
  } else if (state.form.click === 6) {
    setIntervalFunc(30)
  } else if (state.form.click === 7) {
    state.percentageProcess = 30
  } else if (state.form.click === 8) {
    setIntervalFunc(50)
  } else if (state.form.click === 9) {
    setIntervalFunc(90)
  } else if (state.form.click === 10) {
    setIntervalFunc(100);
  }
  state.form.click = store.state.click;
})
const onConfirm = () => {
  state.promptDialog = false;
  window.location.href = `${ state.form.link }`;
};
onMounted(() => {
  getLink();
  state.form.click = store.state?.click;
  state.form.phone = store.state.userInfo?.phone;
  state.form.url = store.state.userInfo?.url
});

</script>
<style lang="scss">
.offer_bgLinear__vFptl {
  background: linear-gradient(175.1deg, rgba(8, 139, 139, .2) 7.38%, rgba(13, 14, 14, 0) 72.52%);
}
.offer_currentActivityBgLinear__ACxZX {
  background: linear-gradient(180deg, #17363a, rgba(23, 54, 58, 0));
  background-position-x: initial;
  background-position-y: initial;
  background-size: initial;
  background-origin: initial;
  background-clip: initial;
}

.offer_btnPointer__89czm {
  -webkit-user-drag: none;
  animation: offer_btnPointer__89czm .8s ease-in-out infinite;
  pointer-events: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

@keyframes offer_btnPointer__89czm {
  0% {
    transform: translate(6px, 6px);
  }

  50% {
    transform: translate(-6px, -6px);
  }

  100% {
    transform: translate(6px, 6px);
  }
}

.offer_helperLinear__lMbnf {
  background-clip: padding-box, border-box;
  background-image: linear-gradient(144.96deg, #364046, #364046), linear-gradient(144.96deg, rgba(157, 221, 231, .74) 9.55%, rgba(152, 228, 231, .07) 86.19%);
  background-origin: padding-box, border-box;
  border: 1px solid transparent;
}

.rounded-1\/2 {
  border-radius: 50%;
}

.el-dialog__body {
  padding: calc(var(--el-dialog-padding-primary) + 0px) var(--el-dialog-padding-primary);
}

.demo-progress .el-progress--line {
  margin-top: 15px;
  width: 320px;
}

.el-message-box__btns .el-button--primary {
  @apply bg-blue-400;
}
</style>
